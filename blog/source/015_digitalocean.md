<!--
{ "title":"Хостинг java 8 приложения на облаке Digitalocean (используем Apache Tomcat 8) ",
  "category":"Java",
  "date":"26.08.2015",
  "change":"26.08.2015",
  "slug":"00015",
  "comments":"" }
-->

## Хостинг java 8 приложения на облаке Digitalocean (используем Apache Tomcat 8) 

### Оглавление

Статья рассчитана на новичков.

Сегодня расскажу от том как: 
* Создать дроплет
* Подключится к нему по ssh (хотя это не обязательно, но удобно), 
* Установка и запуск apache tomcat 8 
* Настройка полномочий и запуска tomcat как сервис
* Загрузить свой проект (пока вручную)
* добавить свое доменное имя 

Также это будет первой из следующий статей (темы могут поменяться)
* [Хостинг java 8 приложения на облаке Digitalocean (используем Apache Tomcat 8) ]()
* Настройка виртуальных хостов на apache tomcat 
* Установка и настройка mongodb на Digitalocean 
* Автоматическая сборка и разворачивание проекта на Digitalocean (с maven, git)
* Переходим на Docker 

### Diginalocean

![digitalocean](https://www.googledrive.com/host/0B2w0rtQkeBZadEpxd3Y2M3hMTUU/blog/0015/01.png)

И так, для хостинга будем использовать облачный сервис [digitalocean](https://www.digitalocean.com/). Вам предоставляют облачный сервер ([VPS](https://ru.wikipedia.org/wiki/VPS)), к которому вы имеете root доступ, в вправе делать с ним, что захотите, т.е. можете поднимать любой http сервер, ставить любое ПО.

В digitalocean ключевое понятие - дроплет (droplet). Это работающая единица, своего рода виртуальная машина, с которой вы в последствии и будете работать.

### Создание дроплета 

Здесь ничего сложного, просто регистрируетесь на сайте [https://cloud.digitalocean.com](https://cloud.digitalocean.com). После регистрации вам нужно привязать платежную карточку или paypal. Цены разные, в зависимости от ресурсов, самый дешевый вариант - 5$ в месяц. Вы можете получить бонус - 10$ - введя промокод от подкаста   [http://www.radio-t.com/](http://www.radio-t.com/) (подробности в любом выпуске).

Для создания дроплета положите деньги на счет, они будут списываться каждый день, в зависимости от созданных вами дроплетов. 

Нажмите "создать новый дроплет"

выберите то решение, что вам нужно:

![digitalocean](https://www.googledrive.com/host/0B2w0rtQkeBZadEpxd3Y2M3hMTUU/blog/0015/02.png)

потом выберите регион, чем ближе он к вам, тем вероятнее будет скорость доступа к серверу. В моем случае это Амстердам.

![digitalocean](https://www.googledrive.com/host/0B2w0rtQkeBZadEpxd3Y2M3hMTUU/blog/0015/03.png)

дальше выберите дистрибудив или приложение. На выбор вам даются разные версии Ubuntu, FreeBSD, Fedora, Debian, CoreOS, CentOS. Я предпочитаю Ubuntu 14.04x64. Вы также можете выбрать образ с предустановленным приложением. Например с Docer (его и советую).

![digitalocean](https://www.googledrive.com/host/0B2w0rtQkeBZadEpxd3Y2M3hMTUU/blog/0015/04.png)

Дальше можно ничего не настраивать, но советую сразу добавить ключ для доступа по ssh.

нажимайте "создать дроплет" и ждите около минуты, вам на почту придет root пароль и ваш IP. 

И сразу можете перейти к вашему дроплету и запустить web консоль 

![digitalocean](https://www.googledrive.com/host/0B2w0rtQkeBZadEpxd3Y2M3hMTUU/blog/0015/05.png)

(в принципе можете через неё можно полноценно работать). При входе вам нужно будет создать изменить root пароль.

Все, теперь у вас есть виртуальная машина, к которой вы имеете полный доступ. 

### Доступ по ssh 

Если вы уже добавили ключ, то можете просто подключиться:

```bash
ssh root@your_id_address
```

Если нужно изменить или добавить новый ключи, зайдите в настройки

![digitalocean](https://www.googledrive.com/host/0B2w0rtQkeBZadEpxd3Y2M3hMTUU/blog/0015/06.png)

И добавьте свой публичный ключ из .ssh/[name].pub

Если у вас нет ssh ключа, сгенерируйте его, подробно процесс не описываю, информацию найти не сложно, в том числе и на русском языке. Если вы счастливый пользователь *unix системы, выполните:

```
ssh-keygen -t rsa
```

если же вы пользователь windows, вам придется дополнительно установить нужное ПО (PuTTY), а еще удобно использовать использовать линуксовый терминал (я предпочитаю использовать git bash)

> Если по настройке и генерации ключей нужно больше информации, сообщите мне, я дополню. 

### Установка java 8 и apache tomcat 8

Я предпочел использовать oracle jdk, и самый новый на данный момент tomcat. По этому вопросу будут полезны статьи:
* [How to install apache tomcat 8 on ubunto 14-04](https://www.digitalocean.com/community/tutorials/how-to-install-apache-tomcat-8-on-ubuntu-14-04)
* [Java ubuntu apt get ru](https://www.digitalocean.com/community/tutorials/java-ubuntu-apt-get-ru)
* [How to install apache tomcat 7 on ubuntu 14.04 via apt-get](https://www.digitalocean.com/community/tutorials/how-to-install-apache-tomcat-7-on-ubuntu-14-04-via-apt-get)

Рекомендую первые 2 ссылки. Самое основное изложу здесь с пояснениями.

Чтобы использовать tomcat, нужно установить java. Первым делом проверьте или её еще нет. Потом добавьте источники, чтобы установить используя apt-get

```bash
sudo apt-get install python-software-properties
sudo add-apt-repository ppa:webupd8team/java
sudo apt-get update

```

теперь установите JDK 8

```bash
sudo apt-get install oracle-java8-installer
```

Проверьте или все работает.

Теперь переходим к установке tomcat, идея простая: скачиваем архив и извлекаем. Устанавливать его не нужно.

[Тут ссылки на скачивания tomcat](http://tomcat.apache.org/download-80.cgi)

Перейдите в home 

```bash
cd ~
```

скачайте архив

```bash
wget http://mirror.sdunix.com/apache/tomcat/tomcat-8/v8.0.23/bin/apache-tomcat-8.0.23.tar.gz
```

нужно извлечь архив. Извлекаем в ```/opt/tomcat```

> **opt** предназначенна для добавления пакетов ПО, или для других компонентов не являющихся базой системы. Некоторые используют её, другие просто ```/usr/local``` - выбор за вами

создайте целевую папку:

```bash
sudo mkdir /opt/tomcat
```

извлеките 

```bash
sudo tar xvf apache-tomcat-8*tar.gz -C /opt/tomcat --strip-components=1
```
> Пояснение по команде ```tar```: ключ ```xvf``` предназначен для извлечения содержимого tar.gz архива. Ключ ```-C``` позволяет создать Tarpipe. Tarpipe — процесс создания tar-архива в stdout и последующего извлечения содержания архива в другом каталоге из stdin. Это очень удобный метод копирования содержания одной файловой системы в другую, так как происходит полное копирование, включая атрибуты файлов, символические ссылки, файлы устройств. Но если просто, вы указываете куда извлечь содержание архива. ```--strip-components=1``` - говорит, что нужно пропустить один уровень в имени, давайте на примере, если запустить без strip, то архив был бы извлечен в каталог ```/opt/tomcat/apache-tomcat-8.0.26/<содержание>``` , а с ключем ```--strip-components=1``` мы получим ```/opt/tomcat/<содержание>```

ну и все, сервер теперь работоспособен, для проверки можете запустить: 

```bash
/opt/tomcat/bin/./catalina sh run
```

откройте ваш браузер: http://<your_ip>:8080 и увидите:

![tomcat](https://www.googledrive.com/host/0B2w0rtQkeBZadEpxd3Y2M3hMTUU/blog/0015/07.png)

### P.S.

Также планирую связанные с Digitalocean статьи [оставил это здесь, чтобы заставить себя это сделать, пообещал - поэтому придется в ближайшее время с этим разобраться ]:
* Веб приложение для моделирования (МКЭ) - моя магисторская, видимо хостить я её буду здесь (или на red hat openshif cloud), там будут замешены angular, REST, МКЭ и WebGL.
* Микросервисы - ну тема сейчас сильно на слуху, нужно с ними познакомиться 
* Сервисы на python для машинного обучения (scikit-learn) - планирую разработать REST-сервис для решения некоторых интересных задача с помощью машинного обучения. Скорее всего буду использовать Flask Framework. Нужно применить знания на чем-то более практическом, чем просто запуск скриптов на компьютере. 